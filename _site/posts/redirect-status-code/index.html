<!DOCTYPE html><html domain="lavi-blog.vercel.app" lang="en"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="default-src 'self';object-src 'none';script-src 'self' 'sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=' 'sha256-za/u+GpTRqxVmtY0/RJrU1alkYqdlDRMaW2bCpySaa8=' 'sha256-Fc9RvR5cQc4eds/61y5EGXrmOqQOE0YF/KJfE7B/NJs=' 'sha256-AvHvdkAvA2liH7FoblyZGebwmSzE3eLp/zZiYQ+l2Qk=' 'sha256-2daR3BDHUgNt2bWp/u+3CNDJtsIDrpz+22+QPnNNS5c=' https://utteranc.es/client.js;style-src 'unsafe-inline' 'self' https://fonts.googleapis.com/ https://fonts.gstatic.com/;img-src 'self' data:;frame-src https://utteranc.es/;font-src https://fonts.gstatic.com/ 'self'" http-equiv="Content-Security-Policy"><link href="/favicon.svg" rel="icon" type="image/svg+xml"><meta content="#f9c412" name="theme-color"><meta content="max-snippet:-1, max-image-preview: large, max-video-preview: -1" name="robots"><title>[極短篇] 關於重新導向的 status code</title><meta content="[極短篇] 關於重新導向的 status code" property="og:title"><meta content="想想下面這個情境。 假設你原本的網站叫做 old.com 後來你換了一個域名，叫做 new.com 再轉換初期你一定是要兩個都保持，不然原本都用 A.com 連線的小朋友們不知道你連到..." name="description"><meta content="想想下面這個情境。 假設你原本的網站叫做 old.com 後來你換了一個域名，叫做 new.com 再轉換初期你一定是要兩個都保持，不然原本都用 A.com 連線的小朋友們不知道你連到..." property="og:description"><meta content="summary_large_image" name="twitter:card"><meta content="@" name="twitter:site"><meta content="@" name="twitter:creator"><link href="https://lavi-blog.vercel.app/posts/redirect-status-code/" rel="canonical"><meta content="no-referrer-when-downgrade" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Apprentice Log"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=c909e7f885" defer=""></script><script csp-hash="sha256-Ky9qZOPnMhQV/s7Fdb9TYAOfU4KtWNqCZaFK8tSzXa0=">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>@import url(https://fonts.googleapis.com/css2?family=Kosugi+Maru&display=swap);
/*! modern-normalize v1.1.0 | MIT License | https://github.com/sindresorhus/modern-normalize */
*,::after,::before{box-sizing:border-box}html{-moz-tab-size:4;-o-tab-size:4;tab-size:4;line-height:1.15;-webkit-text-size-adjust:100%;font-size:var(--font-base-size);width:100vw;letter-spacing:.04ch}body{margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';--color-primary:var(--light-primary);--color-secondary:var(--light-secondary);--color-text:var(--light-text);--color-text-reverse:var(--dark-text);--color-text-secondary:var(--light-text-secondary);--color-bg:hsl(var(--light-bg));--color-bg-reverse:var(--dark-bg);--color-bg-opacity:hsla(var(--light-bg), 0.9);--color-bg-secondary:var(--light-bg-grey);--font-weight-normal:400;background-color:var(--color-bg);color:var(--color-text);overflow-x:hidden}hr{height:0;color:inherit;margin:3rem auto;width:95%}code,pre{font-family:ui-monospace,SFMono-Regular,Consolas,'Liberation Mono',Menlo,monospace}:root{--primary-hue:200;--primary-saturation:20%;--primary-light:60%;--secondary-hue:22;--secondary-saturation:85%;--secondary-light:60%;--text-hue:200;--text-saturation:10%;--text-light:10%;--light-primary:hsl(
      var(--primary-hue),
      var(--primary-saturation),
      var(--primary-light)
    );--light-secondary:hsl(
      var(--secondary-hue),
      var(--secondary-saturation),
      60%
    );--light-text:hsl(var(--text-hue), var(--text-saturation), var(--text-light));--light-text-secondary:hsl(var(--primary-hue), var(--text-saturation), 45%);--light-bg:0, 0%, 98%;--light-bg-grey:hsl(var(--primary-hue), var(--primary-saturation), 90%);--dark-bg:hsl(var(--primary-hue), 15%, 5%);--dark-bg-reverse:hsl(var(--primary-hue), 20%, 20%);--dark-bg-opacity:hsla(var(--primary-hue), var(--primary-saturation), 5%, 95%);--dark-bg-grey:hsl(var(--primary-hue), var(--primary-saturation), 15%);--dark-text:hsl(var(--text-hue), 30%, 90%);--dark-text-secondary:hsl(var(--primary-hue), 35%, 70%);--font-base-size:18px;--breakpoint-s-m:576.98px;--breakpoint-m-l:992.98px;--font-family-serif:Lora, Georgia, Songti TC, Hiragino Mincho Pro, serif;--font-family-sans-serif:"Inter", Roboto, Segoe UI, Ubuntu, Helvetica Neue,
      Helvetica, Arial, "Noto Sans TC", sans-serif;--font-family-mono:"DM mono", monospace, "Kosugi Maru", "Noto Sans TC",
      sans-serif;--font-weight-bold:600;--block-border-radius:1ch}body.dark-theme{--color-primary:var(--light-primary);--color-secondary:var(--light-secondary);--color-text:var(--dark-text);--color-text-reverse:var(--dark-text);--color-text-secondary:var(--dark-text-secondary);--color-bg:var(--dark-bg);--color-bg-reverse:var(--dark-bg-reverse);--color-bg-opacity:var(--dark-bg-opacity);--color-bg-secondary:var(--dark-bg-grey);--font-weight-normal:300}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:400;src:url(/fonts/Inter-Regular.woff2) format("woff2"),url(/fonts/Inter-Regular.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:400;src:url(/fonts/Inter-Italic.woff2) format("woff2"),url(/fonts/Inter-Italic.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:normal;font-weight:600;src:url(/fonts/Inter-SemiBold.woff2) format("woff2"),url(/fonts/Inter-SemiBold.woff) format("woff")}@font-face{font-display:optional;font-family:"Inter UI";font-style:italic;font-weight:600;src:url(/fonts/Inter-SemiBoldItalic.woff2) format("woff2"),url(/fonts/Inter-SemiBoldItalic.woff) format("woff")}@font-face{font-display:optional;font-family:"Lora";font-display:swap;font-style:normal;src:url(/fonts/Lora-Regular.ttf) format("truetype")}@font-face{font-display:optional;font-family:"Lora";font-display:swap;font-style:italic;src:url(/fonts/Lora-Italic.ttf) format("truetype")}@font-face{font-display:optional;font-family:"Lora";font-display:swap;font-weight:600;font-style:italic;src:url(/fonts/Lora-SemiBold.ttf) format("truetype")}@font-face{font-display:optional;font-family:"Lora";font-display:swap;font-weight:600;font-style:italic;src:url(/fonts/Lora-SemiBoldItalic.ttf) format("truetype")}@font-face{font-display:optional;font-family:"DM mono";font-display:swap;font-style:normal;src:url(/fonts/DMMono-Regular.ttf) format("truetype")}@font-face{font-display:optional;font-family:"DM mono";font-display:swap;font-style:italic;src:url(/fonts/DMMono-Regular.ttf) format("truetype")}@font-face{font-display:optional;font-family:"Inter UI var";font-weight:100 900;font-style:oblique 0deg 10deg;src:url(/fonts/Inter.var.woff2) format("woff2")}@font-face{font-display:optional;font-family:"Inter UI var alt";font-weight:100 900;font-style:normal;font-named-instance:"Regular";src:url(/fonts/Inter-roman.var.woff2) format("woff2")}@font-face{font-display:optional;font-family:"Inter UI var alt";font-weight:100 900;font-style:italic;font-named-instance:"Italic";src:url(/fonts/Inter-italic.var.woff2) format("woff2")}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1}*{transition:background-color .1s,color .1s}h1,h2,h3,h4,p{text-decoration:none;font-weight:var(--font-weight-normal);margin:0}.dark-theme h1,.dark-theme h2,.dark-theme h3,.dark-theme h4{font-weight:400}h1,h2,h3,h4{line-height:1.2}li{font-weight:var(--font-weight-normal)}h1{font-size:2rem;padding:3rem 0 1.6rem}h2{font-size:1.6rem;padding:2rem 0 .8rem}h3{font-size:1.4rem;padding:1.6rem 0 .8rem}h4{font-size:1.2rem;padding:1.2rem 0 .8rem}.icon,.icon path{fill:var(--color-primary)}a{text-decoration:none}a:hover{text-decoration:underline}main{margin:50px 0 100px}.caption,.caption a,a{color:var(--color-text-secondary)}.caption,.caption a{font-size:.6rem}.caption a,.post__toc li:hover>a{text-decoration:underline}.tags a::before{content:"#"}.tags{text-transform:capitalize}code{font-size:.9em;font-family:var(--font-family-mono)}:not(pre)>code{display:inline-block;padding:.2ch;background-color:var(--color-bg-reverse);color:var(--color-text-reverse);border-radius:.4ch;margin:0 .4ch;line-height:1.1rem}dialog,pre{background-color:var(--color-bg-reverse)}pre{color:var(--color-text-reverse);margin:1.2rem -2rem;padding:1.2rem 2rem;border-radius:var(--block-border-radius);font-size:.9em;line-height:inherit;overflow-x:auto}dialog{position:fixed;bottom:0;z-index:9999;color:var(--color-secondary);width:100vw;border-width:0;text-align:center;height:-webkit-min-content;height:-moz-min-content;height:min-content}body:not(.dark-theme) #light{display:none}body.dark-theme #dark{display:none}body.dark-theme #light{display:block}body.dark-theme img{filter:brightness(.8) contrast(1.2)}@media (prefers-color-scheme:dark){#light{display:block}img{filter:brightness(.8) contrast(1.2)}}@media (prefers-color-scheme:light){#dark{display:block}}.center{--max-width:63ch;width:100%;display:grid;grid-template-columns:1fr min(var(--max-width),calc(100% - 64px)) 1fr}.center>*{grid-column:2}.center--wide{--max-width:1040px}body .container{display:grid;min-height:100vh;grid-template-rows:auto -webkit-max-content;grid-template-rows:auto max-content}header{top:0;position:sticky;display:flex;align-items:flex-end;margin-top:50px;padding:8px 0 15px;background-color:var(--color-bg);z-index:1}header p{margin-top:0}header>div{width:100%;display:flex;align-items:baseline;justify-content:space-between}#hamburger,.only-mobile{display:none}#hamburger{position:fixed;pointer-events:auto;--hamburger-size:2rem;height:var(--hamburger-size);width:var(--hamburger-size);margin:1.5rem;right:0;z-index:999}#hamburger>*{display:block;width:80%;height:calc(var(--hamburger-size)*.08);background-color:var(--color-primary);position:absolute;top:50%;left:50%;transition:all 400ms cubic-bezier(.84,.06,.52,1.8);transform-origin:center}#hamburger top{transform:translate(-50%,calc(var(--hamburger-size)*.25))}#hamburger mid{transform:translate(-50%,0)}#hamburger btm{transform:translate(-50%,calc(var(--hamburger-size)*-.25))}#hamburger.open top{transform:translate(-50%,0) rotate(45deg)}#hamburger.open mid{opacity:0}#hamburger.open btm{transform:translate(-50%,0) rotate(-45deg)}.header__items,nav{display:flex;align-items:center}.header__items>*{margin:0 .6rem}.header__items svg{height:1rem;width:1rem}.header__theme{height:1rem;overflow:visible}#rss{height:1.2rem;width:1.2rem}nav{align-items:baseline;gap:1.5rem}nav>a{font-size:1rem;font-weight:400;color:var(--color-text-secondary)}.logo{margin:0;padding:0;font-size:1.4rem;text-align:left}.logo a{margin:0;color:var(--color-text);text-decoration:none}.logo svg{height:1.5em;position:relative;top:.3em;margin-right:10px}footer{background-color:var(--color-bg-secondary);padding:2rem 0;height:-webkit-min-content;height:-moz-min-content;height:min-content}.footer{display:flex;justify-content:space-between}.footer__info{text-align:right;display:flex;flex-direction:column;gap:1rem}footer nav{visibility:hidden}@media only screen and (max-device-width:576.98px){.only-mobile{display:inherit}#hamburger{display:block}header{position:fixed;margin-top:0;padding-top:6rem;--transition:all 500ms cubic-bezier(0.075, 0.82, 0.165, 1);transition:var(--transition);pointer-events:auto;opacity:1;background-color:var(--color-bg-opacity);height:100%}header .logo{display:none}header:not(.open){transition:var(--transition);background-color:transparent;pointer-events:none;opacity:0}header>div,nav{flex-direction:column;gap:2rem}header>div{align-items:flex-end;padding-right:2rem;align-self:start}nav{align-items:end}.nav>*{margin:0;font-size:1.2em}.header__items svg{height:1.2em;width:1.2em}.logo--mobile{padding:1.5rem 0;z-index:99}.footer{flex-direction:column}footer nav{visibility:visible}footer nav>.logo,nav{margin-bottom:1rem}}.post__time{font-family:var(--font-family-serif);margin:9px 0 4px}.post__time p,.post__title,article{padding:0}.post__toc{position:fixed;top:50%;padding-left:2rem;transform:translateY(-50%);font-size:.8em;max-height:70vh;overflow-y:scroll;-ms-overflow-style:none;scrollbar-width:none;scroll-behavior:smooth}.post__toc::-webkit-scrollbar{display:none}.post__toc ol{list-style-type:none;padding:0 0 0 1ch;width:20ch}.post__toc ol ol{width:100%}.post__toc li{width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;padding:.2em 0}.post__toc li a{text-decoration:none}.post__toc .current,.post__toc .current>a{color:var(--color-secondary)}.post__content{padding-top:3rem}.post__content h1,.post__content h2,.post__content h3,.post__content h4,.post__content h5,.post__content h6{position:relative}.post__content h1 a[href^="#"],.post__content h2 a[href^="#"],.post__content h3 a[href^="#"],.post__content h4 a[href^="#"],.post__content h5 a[href^="#"],.post__content h6 a[href^="#"]{position:absolute;left:-1.4ch}.post__content h1 a:not([href^="#"]),.post__content h2 a:not([href^="#"]),.post__content h3 a:not([href^="#"]),.post__content h4 a:not([href^="#"]),.post__content h5 a:not([href^="#"]),.post__content h6 a:not([href^="#"]){color:inherit;text-decoration:inherit}.post__content li,.post__content p{line-height:1.6}.post__content p{padding:.8rem 0}.post__content li{padding:.2rem 0}.post__content ol,.post__content ul{padding:1.2rem 1rem 1.2rem 1.8rem;font-family:var(--font-family-serif);margin:0}.post__content ol li::marker,.post__content ul li::marker{color:var(--color-text-secondary)}.post__content p~ol,.post__content p~ul{padding-top:0}.post__content ol li::marker{font-size:1.1em}.post__content ol ol,.post__content ol ul,.post__content ul ol,.post__content ul ul{padding:0 1.2rem}.post__content hr{margin-top:4rem;margin-bottom:4rem}.post__content img{max-height:50vh;width:auto;margin:0 auto}.post__link{display:flex;justify-content:space-between;margin-top:2rem}.post__link>div>*{display:block}.post__link>div>span{font-size:.8em;margin-bottom:.2em}.post__link>div:last-of-type span{text-align:right}@media only screen and (max-device-width:576.98px){.post__content img{max-height:30vh}.post__content pre{margin-right:0;margin-left:0;padding:1.5rem 2ch;width:calc(100vw - 6ch)}.post__toc{background-color:var(--color-bg-secondary);position:static;transform:none;padding:3ch;border-radius:var(--block-border-radius)}.post__toc h4{padding-top:0}.post__toc nav{align-items:flex-start;font-size:1rem;margin:0}.post__toc ol{padding-left:2rem;width:auto}.post__toc li a{display:inline-block;padding-bottom:.3em}.post__toc li{white-space:normal}.post__toc nav>ol{padding-left:0;margin:0}.post__toc .current,.post__toc a:active,.post__toc a:hover{color:inherit}}</style></head><body><script csp-hash="sha256-za/u+GpTRqxVmtY0/RJrU1alkYqdlDRMaW2bCpySaa8=">let isUtterancesLoaded = false;
      const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
      const currentTheme = localStorage.getItem("theme");
      const isDark = currentTheme != null ?　currentTheme === 'dark' : prefersDarkScheme.matches;
      if (isDark) {
          document.body.classList.add('dark-theme');
          setUtterancesTheme('dark');
      } else {  
        document.body.classList.remove('dark-theme');
          setUtterancesTheme('light');
      }
      
      window.addEventListener('message', event => {
        if (event.origin !== 'https://utteranc.es') {
          return;
        }
        isUtterancesLoaded = true
      });

      function setUtterancesTheme(theme) {
        let utterancesIframe = document.querySelector('.utterances iframe')
        if (!isUtterancesLoaded) {
          return requestAnimationFrame(() => setUtterancesTheme(theme))
        }
        utterancesIframe.contentWindow.postMessage({
          type: 'set-theme',
          theme: theme === 'dark' ? 'dark-blue' : 'github-light'
        }, 'https://utteranc.es');
      }</script><dialog id="message"></dialog><header class="center center--wide"><div><nav class="nav"><h1 class="logo"><a href="/" title="Homepage"><svg fill="none" viewBox="0 0 39 33" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M19.5 0L38.1195 32.25H0.880453L19.5 0Z" fill="#90A0A8"></path></svg> Apprentice Log</a></h1><a href="/posts/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a></nav><div class="header__items"><div class="header__theme"><svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" class="icon" id="dark" height="16" width="16"><path d="M6.85141 0.219686C7.03763 0.405907 7.11254 0.676155 7.04875 0.931669C6.92055 1.44524 6.85229 1.98329 6.85229 2.53834C6.85229 6.1886 9.81142 9.14773 13.4617 9.14773C14.0167 9.14773 14.5548 9.07948 15.0683 8.95127C15.3239 8.88749 15.5941 8.96239 15.7803 9.14861C15.9665 9.33483 16.0415 9.60508 15.9777 9.8606C15.0974 13.3869 11.9095 16 8.10939 16C3.6307 16 -1.78814e-07 12.3693 0 7.89062C1.78814e-07 4.09054 2.61311 0.902648 6.13943 0.0223469C6.39495 -0.041439 6.66519 0.0334652 6.85141 0.219686ZM5.37954 1.8693C3.09107 2.90847 1.5 5.21444 1.5 7.89062C1.5 11.5409 4.45913 14.5 8.10939 14.5C10.7856 14.5 13.0915 12.9089 14.1307 10.6205C13.91 10.6385 13.6869 10.6477 13.4617 10.6477C8.98299 10.6477 5.35229 7.01703 5.35229 2.53834C5.35229 2.31317 5.36149 2.09003 5.37954 1.8693Z" fill="black" clip-rule="evenodd" fill-rule="evenodd"></path></svg> <svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" class="icon" id="light" height="16" width="16"><path d="M8.00006 1.17009e-09C8.41427 2.28894e-05 8.75004 0.335828 8.75001 0.750041L8.74999 1.25004C8.74996 1.66426 8.41416 2.00002 7.99994 2C7.58573 1.99998 7.24996 1.66417 7.24999 1.24996L7.25001 0.749959C7.25004 0.335745 7.58584 -2.2887e-05 8.00006 1.17009e-09ZM2.34319 2.34311C2.6361 2.05023 3.11097 2.05026 3.40385 2.34316L3.75738 2.69674C4.05026 2.98965 4.05023 3.46452 3.75732 3.7574C3.46441 4.05027 2.98954 4.05025 2.69666 3.75734L2.34313 3.40377C2.05025 3.11086 2.05028 2.63598 2.34319 2.34311ZM13.6569 2.34319C13.9498 2.6361 13.9497 3.11097 13.6568 3.40385L13.3033 3.75738C13.0104 4.05026 12.5355 4.05023 12.2426 3.75732C11.9497 3.46441 11.9498 2.98954 12.2427 2.69666L12.5962 2.34313C12.8891 2.05025 13.364 2.05028 13.6569 2.34319ZM8.00026 5.5C6.61955 5.5 5.50026 6.61929 5.50026 8C5.50026 9.38071 6.61955 10.5 8.00026 10.5C9.38097 10.5 10.5003 9.38071 10.5003 8C10.5003 6.61929 9.38097 5.5 8.00026 5.5ZM4.00026 8C4.00026 5.79086 5.79112 4 8.00026 4C10.2094 4 12.0003 5.79086 12.0003 8C12.0003 10.2091 10.2094 12 8.00026 12C5.79112 12 4.00026 10.2091 4.00026 8ZM1.17006e-09 7.99994C2.28894e-05 7.58573 0.335828 7.24996 0.750041 7.24999L1.25004 7.25001C1.66426 7.25004 2.00002 7.58584 2 8.00006C1.99998 8.41427 1.66417 8.75004 1.24996 8.75001L0.749959 8.74999C0.335745 8.74996 -2.2887e-05 8.41416 1.17006e-09 7.99994ZM14 7.99994C14 7.58573 14.3358 7.24996 14.75 7.24999L15.25 7.25001C15.6643 7.25004 16 7.58584 16 8.00006C16 8.41427 15.6642 8.75004 15.25 8.75001L14.75 8.74999C14.3357 8.74996 14 8.41416 14 7.99994ZM12.2427 12.2426C12.5356 11.9497 13.0105 11.9498 13.3033 12.2427L13.6569 12.5962C13.9498 12.8891 13.9497 13.364 13.6568 13.6569C13.3639 13.9498 12.889 13.9497 12.5962 13.6568L12.2426 13.3033C11.9497 13.0104 11.9498 12.5355 12.2427 12.2426ZM3.7574 12.2427C4.05027 12.5356 4.05025 13.0105 3.75734 13.3033L3.40377 13.6569C3.11086 13.9498 2.63598 13.9497 2.34311 13.6568C2.05023 13.3639 2.05025 12.889 2.34316 12.5962L2.69674 12.2426C2.98965 11.9497 3.46452 11.9498 3.7574 12.2427ZM8.00006 14C8.41427 14 8.75004 14.3358 8.75001 14.75L8.74999 15.25C8.74996 15.6643 8.41416 16 7.99994 16C7.58573 16 7.24996 15.6642 7.24999 15.25L7.25001 14.75C7.25004 14.3357 7.58584 14 8.00006 14Z" fill="black" clip-rule="evenodd" fill-rule="evenodd"></path></svg></div><a href="/feed/feed.xml"><svg fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="icon" id="rss"><path d="M3.75 3C3.33579 3 3 3.33579 3 3.75C3 4.16421 3.33579 4.5 3.75 4.5H4.82759C10.7216 4.5 15.5 9.27925 15.5 15.1751V16.25C15.5 16.6642 15.8358 17 16.25 17C16.6642 17 17 16.6642 17 16.25V15.1751C17 8.45116 11.5504 3 4.82759 3H3.75Z"></path><path d="M3 7.19904C3 6.78482 3.33579 6.44904 3.75 6.44904H4.82759C9.64596 6.44904 13.5517 10.356 13.5517 15.1751V16.2499C13.5517 16.6642 13.2159 16.9999 12.8017 16.9999C12.3875 16.9999 12.0517 16.6642 12.0517 16.2499V15.1751C12.0517 11.1841 8.8172 7.94904 4.82759 7.94904H3.75C3.33579 7.94904 3 7.61325 3 7.19904Z"></path><path d="M3.75 9.89813C3.33579 9.89813 3 10.2339 3 10.6481C3 11.0623 3.33579 11.3981 3.75 11.3981H4.82759C6.91277 11.3981 8.60345 13.089 8.60345 15.1751V16.2499C8.60345 16.6642 8.93923 16.9999 9.35345 16.9999C9.76766 16.9999 10.1034 16.6642 10.1034 16.2499V15.1751C10.1034 12.2609 7.74153 9.89813 4.82759 9.89813H3.75Z"></path><path d="M5 13C3.89543 13 3 13.8954 3 15C3 16.1046 3.89543 17 5 17C6.10457 17 7 16.1046 7 15C7 13.8954 6.10457 13 5 13ZM4.5 15C4.5 14.7239 4.72386 14.5 5 14.5C5.27614 14.5 5.5 14.7239 5.5 15C5.5 15.2761 5.27614 15.5 5 15.5C4.72386 15.5 4.5 15.2761 4.5 15Z" clip-rule="evenodd" fill-rule="evenodd"></path></svg></a></div></div></header><div id="hamburger"><top></top><mid></mid><btm></btm></div><div class="container"><div class="center only-mobile"><h1 class="logo logo--mobile"><a href="/" title="Homepage"><svg fill="none" viewBox="0 0 39 33" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M19.5 0L38.1195 32.25H0.880453L19.5 0Z" fill="#90A0A8"></path></svg> Apprentice Log</a></h1></div><main class="center"><div class="post__tags tags"><a href="/tags/http/">HTTP</a></div><h1 class="post__title" id="title">[極短篇] 關於重新導向的 status code</h1><div class="post__time"><p><time datetime="2021-07-15">Jul,15 2021・5min read.</time></p></div><aside class="post__toc"><h4 class="only-mobile">TOC</h4><nav class="toc"><ol><li data-header="%E6%B0%B8%E4%B9%85%E9%82%84%E6%98%AF%E8%87%A8%E6%99%82"><a href="#%E6%B0%B8%E4%B9%85%E9%82%84%E6%98%AF%E8%87%A8%E6%99%82">永久還是臨時</a></li><li data-header="%E9%87%8D%E5%B0%8E%E5%90%91%E4%B9%8B%E5%BE%8C%E7%9A%84-request-method-%E9%82%84%E6%9C%89-body"><a href="#%E9%87%8D%E5%B0%8E%E5%90%91%E4%B9%8B%E5%BE%8C%E7%9A%84-request-method-%E9%82%84%E6%9C%89-body">重導向之後的 request method 還有 body</a></li></ol></nav></aside><article class="post__content"><p>想想下面這個情境。</p><p>假設你原本的網站叫做 <a href="http://old.com">old.com</a> 後來你換了一個域名，叫做 <a href="http://new.com">new.com</a></p><p>再轉換初期你一定是要兩個都保持，不然原本都用 <a href="http://A.com">A.com</a> 連線的小朋友們不知道你連到 <a href="http://B.com">B.com</a>，他們就不知你的網站到哪裡去了。就像你的店名原本叫台南牛肉麵，突然你想要愛逮丸一點，叫做台灣牛肉麵，但其他人只知道台南牛肉麵，一直問台南牛肉麵在哪裡，殊不知你已經改名子了（好啦，如果問人一定還是知道台灣牛肉麵就是以前的台南牛肉麵）。</p><p>所以在換域名初期你會兩個域名都先保留，等大家都記住 <a href="http://new.com">new.com</a> 的時候在把 <a href="http://old.com">old.com</a> 關掉。 但是大家都還是用 <a href="http://old.com">old.com</a> 連怎麼辦？我們會把 IP 掛到 <a href="http://new.com">new.com</a>，然後 <a href="http://old.com">old.com</a> 用 redirect 的方式導到 <a href="http://new.com">new.com</a>。</p><p>那我們要怎麼 Redirect？我們可以透過下面幾種方式</p><ul><li>response header 的 location</li><li>HTML 的 meta 元素 HTML 重新導向機制</li><li>JS 的 <code>window.location = URL</code>。</li></ul><p>後面兩個可能比較不熟悉，這裡不詳細講這個東西，可以看這邊 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Redirections#%E8%AE%BE%E5%AE%9A%E9%87%8D%E5%AE%9A%E5%90%91%E6%98%A0%E5%B0%84%E7%9A%84%E5%85%B6%E4%BB%96%E6%96%B9%E6%B3%95">設定重新導向的其他方法</a></p><p>平常我們輸入 domain name 之後的流程是這樣的：</p><pre><code>1. client: old.com =&gt; DNS server
2. DNS server: IP =&gt; client
3. client: IP =&gt; server 
4. server: response =&gt; client
</code></pre><p>當我們拿到 IP 之後，為了減少之後重新向 DNS server request，所以瀏覽器有 cache 會記錄 域名 還有 IP的對，減少向 DNS request 的次數。那如果平常重新導向，會是這樣的流程</p><pre><code>1. client: old.com =&gt; DNS server
2. DNS server: IP =&gt; client
3. client: IP =&gt; server 
4. server: response(根據 domain name) redirect to new.com =&gt; client
5. cient : new.com =&gt; DNS server
6. DNS server: IP =&gt; client
7. client: IP =&gt; server
</code></pre><p>在第四個步驟 <code>server: response(根據 domain name)</code> 有個很重要的點，就是 Status code 這會影響到瀏覽器重新導向的方式，簡單來說重導向需要考慮的點有幾個。</p><h3 id="%E6%B0%B8%E4%B9%85%E9%82%84%E6%98%AF%E8%87%A8%E6%99%82"><a href="#%E6%B0%B8%E4%B9%85%E9%82%84%E6%98%AF%E8%87%A8%E6%99%82" class="direct-link">#</a> 永久還是臨時</h3><p>這個東西的影響層面跟瀏覽器還有搜尋引擎有關係。</p><p>剛剛有提到說瀏覽器會用 cache 紀錄域名還有 IP，如果是永久導向，那麼瀏覽器就會修改紀錄，例如像剛剛的流程，假如我們是永久導向。</p><pre><code>1. 使用者輸入 old.com
2. 瀏覽器翻了 cache 發現這樣一筆紀錄 old.com: 3.444.555.666 了，指向到 3.444.555.666，直接向 3.444.555.666 發送 request。
3. reponse 顯示：永久 redirect to new.com 
4. new.com 發現 cache 裡面沒有，所以向 DNS 找找，於是找到 3.444.555.666
5. 瀏覽器發現說這個網頁已經永久導向了，所以修改剛剛的紀錄變成 old.com: new.com, new.com: 3.444.555.666。
</code></pre><p>所以之後如果我們要搜尋 <a href="http://new.com">new.com</a> 就不會再找 DNS了，而且輸入 <a href="http://old.com">old.com</a> 也不會再重新發 request 到 <a href="http://old.com">old.com</a>，因為已經紀錄說 <a href="http://old.com">old.com</a> 已經導向到 <a href="http://new.com">new.com</a></p><p>如果是臨時導向呢？就不會有改紀錄這個動作，還是會重複原本的步驟。</p><p>要注意的是，並不一定 <a href="http://new.com">new.com</a> 跟 <a href="http://old.com">old.com</a> 都在同一個 server 上，也有可能在不同 server，像是短網址的服務，或者是你整個部落格也跟著搬 server 換 IP 也有可能。</p><p>而決定永久還是臨時的就是靠 status code</p><ul><li>永久： 301, 308</li><li>臨時： 302, 303, 307</li><li>其他：<ul><li>304 會被導到舊網頁</li><li>300 用戶可以自己選</li></ul></li></ul><h3 id="%E9%87%8D%E5%B0%8E%E5%90%91%E4%B9%8B%E5%BE%8C%E7%9A%84-request-method-%E9%82%84%E6%9C%89-body"><a href="#%E9%87%8D%E5%B0%8E%E5%90%91%E4%B9%8B%E5%BE%8C%E7%9A%84-request-method-%E9%82%84%E6%9C%89-body" class="direct-link">#</a> 重導向之後的 request method 還有 body</h3><p>還有一個問題是，如果發出的 request 不是 get 呢？例如說：你是發送表單，用的是 POST method，而且夾帶著 form data，結果 request 之後 method 變成 get，那就完全送不出資料了。</p><p>所以另外一個考量點就是，redirect 之後的 request method 還有 body。 有幾種選項</p><ul><li>GET 不變、其他 method 可能會變成 GET： 303</li><li>method 跟 body 都不會變：307, 308</li></ul><p>為什麼沒有 301 跟 302 ？因為當初規範沒有講清楚這個東西，所以一個規範各表，變成有些有些有改、有些沒改。上面的 303, 307, 308 就是為了統一所以提出的新規範。</p><p>關於 rediredct 的 status code 大概是這樣，感謝大家收看。</p><p>參考自：</p><ul><li><a href="https://zhuanlan.zhihu.com/p/60669395">HTTP 中的 301、302、303、307、308 响应状态码</a></li><li><a href="https://medium.com/@dubiety/%E6%90%9E%E6%87%82-http-3xx-%E9%87%8D%E6%96%B0%E5%B0%8E%E5%90%91%E7%8B%80%E6%85%8B%E7%A2%BC-f1a288c1cd20">搞懂 http 3xx 重新導向狀態碼</a></li><li>使用情境可以看<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Redirections#%E6%B0%B8%E4%B9%85%E9%87%8D%E5%AE%9A%E5%90%91">這邊</a></li></ul></article><div class="post__tags tags"><h2>tags</h2><a href="/tags/http/">HTTP</a></div><div class="post__link"><div><span>Prev</span><a href="/posts/react-batch-update/" class="">React 的 batch update 策略，包含 React 18 和 hooks</a></div><div><span>Next</span><a href="/posts/deploy-and-cloud/" class="">從本地到雲端，淺談部署和各種部署姿勢</a></div></div><hr class="post__devider"><div class="utterances"></div><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" issue-term="title" label="utterance" repo="Lauviah0622/Lavi-blog" theme="github-light"></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "[極短篇] 關於重新導向的 status code",
  "image": [],
  "author": "Lavi", 
  "genre": "Insert a schema.org genre", 
  "publisher": {
    "@type": "Organization",
    "name": "Lavi",
    "logo": {
      "@type": "ImageObject",
      "url": "/img/favicon/favicon-192x192.png?hash=46a52117ad"
    }
  },
  "url": "https://lavi-blog.vercel.app/posts/redirect-status-code/",
  "mainEntityOfPage": "https://lavi-blog.vercel.app/posts/redirect-status-code/",
  "datePublished": "2021-07-15",
  "dateModified": "2021-10-22",
  "description": "想想下面這個情境。 假設你原本的網站叫做 old.com 後來你換了一個域名，叫做 new.com 再轉換初期你一定是要兩個都保持，不然原本都用 A.com 連線的小朋友們不知道你連到..."
}</script><script csp-hash="sha256-Fc9RvR5cQc4eds/61y5EGXrmOqQOE0YF/KJfE7B/NJs=">let prevElement;
 const io = new IntersectionObserver(
  (entries) => {
    entries.forEach((entry) => {
      const id = entry.target.id
        if (id === "title") {
          const title = document.querySelector(`#${id}`)
          if (prevElement) {
            prevElement.classList.remove('current');
          }
          return  
        }
        const current = document.querySelector(`[data-header="${id}"]`);
        if (current == null) return 
        if (entry.isIntersecting) {
          current.classList.add('current');
          

          let scrollTo = current.offsetTop - 100;
          current.offsetParent.scrollTo(0, scrollTo < 0 ? 0 : scrollTo);
          if (prevElement && prevElement != current) {
            prevElement.classList.remove('current');
          }
          prevElement = current
        }
        
    });
  },
  {
    rootMargin: "-10% 0% -70% 0%",
  }
);

// Declares what to observe, and observes its properties.
const boxElList = document.querySelectorAll('h1, h2, h3, h4');
boxElList.forEach((el) => {
    io.observe(el);
})</script></main><footer class="center center--wide"><div class="footer"><div><nav class="nav"><h1 class="logo"><a href="/" title="Homepage"><svg fill="none" viewBox="0 0 39 33" xmlns="http://www.w3.org/2000/svg" class="icon"><path d="M19.5 0L38.1195 32.25H0.880453L19.5 0Z" fill="#90A0A8"></path></svg> Apprentice Log</a></h1><a href="/posts/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a></nav></div><div class="caption footer__info"><div><a href="https://github.com/Lauviah0622" target="_blank"><svg fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" height="24" width="24"><path d="M12.026 2C7.13295 1.99937 2.96183 5.54799 2.17842 10.3779C1.395 15.2079 4.23061 19.893 8.87302 21.439C9.37302 21.529 9.55202 21.222 9.55202 20.958C9.55202 20.721 9.54402 20.093 9.54102 19.258C6.76602 19.858 6.18002 17.92 6.18002 17.92C5.99733 17.317 5.60459 16.7993 5.07302 16.461C4.17302 15.842 5.14202 15.856 5.14202 15.856C5.78269 15.9438 6.34657 16.3235 6.66902 16.884C6.94195 17.3803 7.40177 17.747 7.94632 17.9026C8.49087 18.0583 9.07503 17.99 9.56902 17.713C9.61544 17.207 9.84055 16.7341 10.204 16.379C7.99002 16.128 5.66202 15.272 5.66202 11.449C5.64973 10.4602 6.01691 9.5043 6.68802 8.778C6.38437 7.91731 6.42013 6.97325 6.78802 6.138C6.78802 6.138 7.62502 5.869 9.53002 7.159C11.1639 6.71101 12.8882 6.71101 14.522 7.159C16.428 5.868 17.264 6.138 17.264 6.138C17.6336 6.97286 17.6694 7.91757 17.364 8.778C18.0376 9.50423 18.4045 10.4626 18.388 11.453C18.388 15.286 16.058 16.128 13.836 16.375C14.3153 16.8651 14.5612 17.5373 14.511 18.221C14.511 19.555 14.499 20.631 14.499 20.958C14.499 21.225 14.677 21.535 15.186 21.437C19.8265 19.8884 22.6591 15.203 21.874 10.3743C21.089 5.54565 16.9181 1.99888 12.026 2Z" fill="#2E3A59"></path></svg></a></div><p>© 2020-present Lavi. All Rights Reserved.<br>This website based on <a href="https://www.industrialempathy.com/posts/eleventy-high-performance-blog/">eleventy-high-performance-blog</a>.</p></div></div></footer></div><script csp-hash="sha256-AvHvdkAvA2liH7FoblyZGebwmSzE3eLp/zZiYQ+l2Qk=">const dark = document.querySelector('#dark');
      const light = document.querySelector('#light');
      dark.addEventListener('click', () => {
        document.body.classList.add('dark-theme')
        localStorage.setItem("theme", 'dark')
        setUtterancesTheme('dark');
      })
      light.addEventListener('click', () => {
        document.body.classList.remove('dark-theme')
        localStorage.setItem("theme", 'light')
        setUtterancesTheme('light');
      })
      const ham = document.querySelector('#hamburger');
      ham.addEventListener('click', () => {
        document.querySelector('header').classList.toggle('open')
        ham.classList.toggle('open');
      })</script></body></html>